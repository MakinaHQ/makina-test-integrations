# implem: https://etherscan.io/address/0x67fe41A94e779CcFa22cff02cc2957DC9C0e4286#code
protocol: "curve"

inputs:
  token_a_address:
    type: "address"
  token_b_address:
    type: "address"
  pool_address:
    type: "address"
  gauge_address:
    type: "address"
  lp_token_address:
    type: "address"
  context_helper_address:
    type: "address"

actions:
  deposit_balanced:
    calls:
      - description: "Get caliber's address"
        target: ${inputs.context_helper_address}
        selector: "msgSender()"
        parameters: []
        return:
          name: "caliber_address"
          type: "address"

      - description: "Approve token A to the pool"
        target: "${inputs.token_a_address}"
        selector: "approve(address,uint256)"
        parameters:
          - type: "address"
            value: "${inputs.pool_address}"
          - type: "uint256"
            value: "${input_slots.amount_tokena}"

      - description: "Approve token B to the pool"
        target: "${inputs.token_b_address}"
        selector: "approve(address,uint256)"
        parameters:
          - type: "address"
            value: "${inputs.pool_address}"
          - type: "uint256"
            value: "${input_slots.amount_tokenb}"

      - description: "Add liquidity to the pool"
        target: "${inputs.pool_address}"
        selector: "add_liquidity(uint256[2],uint256)"
        parameters:
          - type: "uint256[2]"
            value:
              - type: "uint256"
                value: "${input_slots.amount_tokena}"
              - type: "uint256"
                value: "${input_slots.amount_tokenb}"
          - type: "uint256"
            value: "${input_slots.min_mint_amount}"
        return:
          name: "lp_tokens_received"
          type: "uint256"

      - description: "Approve LP tokens to the gauge"
        target: "${inputs.lp_token_address}"
        selector: "approve(address,uint256)"
        parameters:
          - type: "address"
            value: "${inputs.gauge_address}"
          - type: "uint256"
            value: "${returns.lp_tokens_received}"

      - description: "Deposit LP tokens to the gauge"
        target: "${inputs.gauge_address}"
        selector: "deposit(uint256)"
        parameters:
          - type: "uint256"
            value: "${returns.lp_tokens_received}"

    input_slots:
      amount_tokena:
        type: "uint256"
        description: "The amount of token A to deposit"
      amount_tokenb:
        type: "uint256"
        description: "The amount of token B to deposit"
      min_mint_amount:
        type: "uint256"
        description: "The minimum amount of LP tokens to receive"
